<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generator Prompt AI untuk Microstock</title>
    <script>
        // Suppress Tailwind CDN production warning BEFORE loading Tailwind
        (function() {
            const originalConsole = {
                warn: console.warn,
                log: console.log,
                error: console.error
            };
            
            ['warn', 'log', 'error'].forEach(method => {
                console[method] = function(...args) {
                    const message = String(args[0] || '');
                    if (message.includes('should not be used in production') || 
                        message.includes('cdn.tailwindcss.com') ||
                        message.includes('tailwindcss.com')) {
                        return; // Suppress Tailwind warnings
                    }
                    originalConsole[method].apply(console, args);
                };
            });
        })();
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Warm Neutral with Teal Accent -->
    <!-- Application Structure Plan: A generator-focused SPA. The primary view is the Prompt Generator. All other analytical sections are now dynamically generated by Gemini upon tab selection, requiring an API key. This makes the entire application feel "live" and AI-powered, while keeping the initial view clean. -->
    <!-- Visualization & Content Choices: 
        - Prompt Generator (Primary Feature) -> Goal: Provide a powerful, practical tool -> Viz: A comprehensive form with sliders, checkboxes, and advanced optional settings -> Interaction: User inputs API key, selects theme, number of prompts (via slider), and optional Midjourney v7 parameters -> Justification: Fulfills all user requests for more control, batch actions, and a focused UI.
        - ‚ú® AI-Generated Dynamic Tabs (New) -> Goal: Restore informational content in an intelligent way -> Viz: On-demand generated HTML for each section -> Interaction: User clicks a tab, a spinner shows, and Gemini generates the content (tables, cards, text) based on a specific prompt for that section. Requires API key. -> Justification: Directly addresses user feedback by restoring content dynamically, making the app more powerful and interactive.
        - All other features (Image Analysis, Dynamic Themes, Batch Actions) are retained and enhanced with clearer API key dependency notifications.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, color 0.2s;
            font-weight: 500;
            color: #4b5563; /* text-gray-600 */
        }
        .nav-link:hover {
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #111827; /* text-gray-900 */
        }
        .nav-link.active {
            background-color: #e0f2f1; /* bg-teal-50 */
            color: #0d9488; /* text-teal-600 */
            font-weight: 600;
        }
        .section-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            transition: all 0.3s ease-in-out;
        }
        .concept-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .concept-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1);
        }
        .details-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .details-content.open {
            max-height: 1000px; /* Large enough to fit content */
        }
        .prompt-block {
            cursor: pointer;
            border: 2px solid transparent;
        }
        .prompt-block:hover, .prompt-block.active {
            border-color: #14b8a6; /* border-teal-500 */
            background-color: #f0fdfa; /* bg-teal-50 */
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #0d9488;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        [data-collapsible-content] {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .file-upload-label {
            border: 2px dashed #cbd5e1;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            border-radius: 0.5rem;
        }
        .file-upload-label:hover {
            border-color: #0d9488;
            background-color: #f0fdfa;
        }
        
        /* Dark Mode Styles */
        .dark {
            background-color: #0f172a;
            color: #e2e8f0;
        }
        .dark .bg-white {
            background-color: #1e293b !important;
        }
        .dark .bg-stone-100 {
            background-color: #0f172a !important;
        }
        .dark .bg-stone-50 {
            background-color: #1e293b !important;
        }
        .dark .text-stone-900 {
            color: #e2e8f0 !important;
        }
        .dark .text-stone-800 {
            color: #cbd5e1 !important;
        }
        .dark .text-stone-700 {
            color: #94a3b8 !important;
        }
        .dark .text-stone-600 {
            color: #64748b !important;
        }
        .dark .border-stone-200 {
            border-color: #334155 !important;
        }
        .dark .border-stone-300 {
            border-color: #475569 !important;
        }
        .dark .section-card {
            background-color: #1e293b !important;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.3), 0 2px 4px -2px rgb(0 0 0 / 0.3);
        }
        .dark input, .dark select, .dark textarea {
            background-color: #334155 !important;
            border-color: #475569 !important;
            color: #e2e8f0 !important;
        }
        .dark input::placeholder, .dark textarea::placeholder {
            color: #94a3b8 !important;
        }
        .dark input:focus, .dark select:focus, .dark textarea:focus {
            border-color: #0d9488 !important;
            ring-color: #0d9488 !important;
        }
        .dark option {
            background-color: #334155 !important;
            color: #e2e8f0 !important;
        }
        .dark .bg-blue-50 {
            background-color: #1e293b !important;
        }
        .dark .bg-blue-100 {
            background-color: #334155 !important;
        }
        .dark .text-blue-800 {
            color: #93c5fd !important;
        }
        .dark .border-blue-200 {
            border-color: #475569 !important;
        }
        .dark .border-blue-400 {
            border-color: #60a5fa !important;
        }
        .dark .bg-yellow-50 {
            background-color: #1e293b !important;
        }
        .dark .text-yellow-800 {
            color: #fbbf24 !important;
        }
        .dark .border-yellow-400 {
            border-color: #f59e0b !important;
        }
    </style>
</head>
<body class="bg-stone-100 text-stone-800">

    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="w-64 bg-white p-4 border-r border-stone-200 fixed top-0 left-0 h-full z-20 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out">
            <h1 class="text-xl font-bold text-teal-700 mb-6 px-2">Dasbor Strategis</h1>
            <nav class="space-y-2">
                <a href="#prompt-generator" class="nav-link active">
                    <span class="mr-3">üöÄ</span> Generator Prompt
                </a>
                <a href="#image-analyzer" class="nav-link">
                    <span class="mr-3">‚ú®</span> Analisis Tren Visual
                </a>
                <a href="#how-to-use" class="nav-link">
                    <span class="mr-3">‚ùì</span> Cara Penggunaan
                </a>
            </nav>
            
            <!-- Settings -->
            <div class="mt-8 pt-4 border-t border-stone-200">
                <h3 class="text-sm font-semibold text-stone-700 mb-3">Pengaturan</h3>
                
                <!-- Theme Toggle -->
                <div class="mb-4">
                    <label class="block text-xs text-stone-600 mb-1">Mode Tema</label>
                    <button id="theme-toggle" class="w-full flex items-center justify-between px-3 py-2 text-sm border border-stone-300 rounded-md hover:bg-stone-50 focus:ring-teal-500 focus:border-teal-500">
                        <span id="theme-text">‚òÄÔ∏è Mode Terang</span>
                        <span id="theme-icon">üåô</span>
                    </button>
                </div>
            </div>
        </aside>

        <!-- Mobile Header -->
        <header class="md:hidden fixed top-0 left-0 right-0 bg-white shadow-md p-4 z-10 flex justify-between items-center">
            <h1 class="text-xl font-bold text-teal-700">Generator Prompt</h1>
            <button id="menu-toggle" class="text-gray-700 focus:outline-none">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </header>
        
        <div id="overlay" class="md:hidden fixed inset-0 bg-black opacity-0 z-10 transition-opacity duration-300 ease-in-out pointer-events-none"></div>

        <!-- Main Content -->
        <main class="flex-1 md:ml-64 p-4 sm:p-6 lg:p-8 mt-16 md:mt-0">
            
            <!-- Section: Prompt Generator -->
            <section id="prompt-generator" class="content-section space-y-6">
                <div class="section-card">
                    <h2 class="text-2xl font-bold text-stone-900 mb-2">üöÄ Generator Prompt AI</h2>
                    <p class="text-stone-600">Fokus utama aplikasi ini. Gunakan alat ini untuk menerapkan pengetahuan strategis. Pilih penyedia AI, masukkan kunci API Anda, pilih tema, dan sesuaikan detail untuk membuat prompt yang siap digunakan untuk menciptakan aset microstock bernilai tinggi.</p>
                    <div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 rounded-r-lg">
                        <h4 class="font-bold">Catatan Penting</h4>
                        <p class="text-sm">Bagi pengguna yang berpegang pada prinsip Islam, kami sangat menyarankan untuk tidak menghasilkan gambar yang mengandung unsur manusia atau hewan (makhluk bernyawa). Silakan fokus pada tema-tema seperti alam (pemandangan, tumbuhan), arsitektur, objek benda mati, atau konsep abstrak untuk menjaga kesesuaian dengan keyakinan Anda.</p>
                    </div>
                </div>

                <div class="section-card">
                    <div class="space-y-6">
                        <div>
                            <label for="api-provider" class="block text-sm font-medium text-stone-700">1. Pilih Penyedia AI</label>
                            <select id="api-provider" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                                <option value="gemini">Google (Gemini 1.5 Flash)</option>
                                <option value="openai">OpenAI (GPT-4o)</option>
                                <option value="claude">Anthropic (Claude 3 Sonnet)</option>
                            </select>
                        </div>
                        <div>
                            <label for="api-key" class="block text-sm font-medium text-stone-700">2. Kunci API Anda</label>
                            <div class="mt-1 p-3 bg-blue-50 border border-blue-200 text-blue-800 text-xs rounded-md">
                                Kunci API Anda diperlukan untuk menggunakan fitur-fitur AI di aplikasi ini. Kunci Anda tidak disimpan dan hanya digunakan untuk komunikasi langsung dengan penyedia AI pilihan Anda.
                            </div>
                            <div class="relative">
                                <input type="password" id="api-key" placeholder="Masukkan kunci API Anda di sini" class="mt-2 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md focus:ring-teal-500 focus:border-teal-500 pr-10">
                                <div id="api-key-status" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-sm hidden">
                                    <span id="api-key-valid" class="text-green-600 hidden">‚úì</span>
                                    <span id="api-key-invalid" class="text-red-600 hidden">‚úó</span>
                                    <span id="api-key-loading" class="text-gray-400 hidden">‚è≥</span>
                                </div>
                            </div>
                            <div id="api-key-message" class="mt-1 text-xs hidden"></div>
                        </div>
                        <div>
                            <div class="flex justify-between items-center">
                                <label for="evergreen-theme" class="block text-sm font-medium text-stone-700">3. Pilih Tema Evergreen</label>
                                <button id="fetch-theme-ideas-btn" class="text-sm font-medium text-teal-600 hover:text-teal-800">‚ú® Cari Ide Tema dengan AI</button>
                            </div>
                            <select id="evergreen-theme" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                                <option value="Arsitektur & Objek">Arsitektur & Objek</option>
                                <option value="Pemandangan Alam & Tekstur">Pemandangan Alam & Tekstur</option>
                                <option value="Keberlanjutan & Teknologi Hijau">Keberlanjutan & Teknologi Hijau</option>
                                <option value="Teknologi & Keamanan Data">Teknologi & Keamanan Data</option>
                                <option value="Konsep Bisnis & Keuangan Abstrak">Konsep Bisnis & Keuangan Abstrak</option>
                                <option value="Kesehatan & Kebugaran (tanpa manusia)">Kesehatan & Kebugaran (tanpa manusia)</option>
                            </select>
                        </div>
                        <div>
                            <label for="custom-details" class="block text-sm font-medium text-stone-700">4. Tambahkan Detail Kustom (Opsional)</label>
                            <textarea id="custom-details" rows="3" placeholder="Contoh: 'sebuah masjid modern dengan desain minimalis', 'hindari gambar manusia atau hewan', 'fokus pada objek dan arsitektur', 'gunakan palet warna bumi'" class="mt-1 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md focus:ring-teal-500 focus:border-teal-500"></textarea>
                        </div>
                        <div>
                           <label for="prompt-count" class="block text-sm font-medium text-stone-700">5. Jumlah Prompt: <span id="prompt-count-value" class="font-bold text-teal-600">10</span></label>
                           <input type="range" id="prompt-count" min="1" max="100" value="10" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>

                        <!-- Midjourney Settings -->
                        <div class="relative flex items-start">
                            <div class="flex items-center h-5">
                                <input id="mj-settings-checkbox" type="checkbox" class="focus:ring-teal-500 h-4 w-4 text-teal-600 border-gray-300 rounded">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="mj-settings-checkbox" class="font-medium text-stone-700">Tambahkan Pengaturan Lanjutan Midjourney v7</label>
                            </div>
                        </div>
                        <div id="mj-settings-content" data-collapsible-content class="pl-5 border-l-2 border-stone-200 space-y-4">
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <label for="mj-ar" class="block text-sm font-medium text-stone-700">Aspect Ratio (`--ar`)</label>
                                    <select id="mj-ar" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                                        <option value="">Default</option>
                                        <option value="16:9">16:9 (Landscape)</option>
                                        <option value="1:1">1:1 (Square)</option>
                                        <option value="2:3">2:3 (Portrait)</option>
                                        <option value="4:5">4:5 (Portrait)</option>
                                        <option value="9:16">9:16 (Tall Portrait)</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="mj-style" class="block text-sm font-medium text-stone-700">Style (`--style`)</label>
                                    <select id="mj-style" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-teal-500 focus:border-teal-500 sm:text-sm rounded-md">
                                        <option value="">Default</option>
                                        <option value="raw">Raw</option>
                                        <option value="cute">Cute</option>
                                        <option value="scenic">Scenic</option>
                                        <option value="original">Original</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label for="mj-stylize" class="block text-sm font-medium text-stone-700">Stylize (`--s`) <span id="mj-stylize-value" class="font-bold text-teal-600">100</span></label>
                                <input type="range" id="mj-stylize" min="0" max="1000" value="100" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                            <div>
                                <label for="mj-chaos" class="block text-sm font-medium text-stone-700">Chaos (`--c`) <span id="mj-chaos-value" class="font-bold text-teal-600">0</span></label>
                                <input type="range" id="mj-chaos" min="0" max="100" value="0" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            </div>
                        </div>

                        <div>
                            <button id="generate-btn" class="w-full inline-flex justify-center py-3 px-4 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500">
                                Hasilkan Prompt
                            </button>
                        </div>
                    </div>
                </div>

                <div id="result-container" class="section-card hidden">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-semibold text-stone-900">Prompt yang Dihasilkan</h3>
                        <div id="batch-actions" class="hidden space-x-2">
                            <button id="copy-all-btn" class="inline-flex items-center px-3 py-1.5 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">Salin Semua</button>
                            <button id="download-btn" class="inline-flex items-center px-3 py-1.5 border border-transparent text-sm font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700">Unduh (.txt)</button>
                        </div>
                    </div>
                    <div id="loading-spinner" class="hidden flex justify-center items-center my-4">
                        <div class="spinner"></div>
                    </div>
                    <div id="error-message" class="hidden p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg" role="alert">
                    </div>
                    <div id="prompt-output-container" class="hidden space-y-4">
                        <!-- Generated prompts will be injected here -->
                    </div>
                </div>
            </section>

            <!-- Section: Image Analyzer -->
            <section id="image-analyzer" class="content-section hidden space-y-6">
                <div class="section-card">
                    <h2 class="text-2xl font-bold text-stone-900 mb-2">‚ú® Analisis Tren Visual dengan AI</h2>
                    <p class="text-stone-600">Punya gambar referensi yang sukses atau sedang tren? Unggah di sini. AI akan menganalisisnya dan memberikan rincian mendalam tentang subjek, komposisi, gaya, dan kata kunci potensial untuk membantu Anda membuat karya serupa yang berkualitas.</p>
                </div>
                <div class="section-card">
                    <div class="mb-4 p-3 bg-blue-50 border border-blue-200 text-blue-800 text-xs rounded-md">
                        Fitur ini memerlukan kunci API Anda. Masukkan kunci API Anda di tab "Generator Prompt" untuk mengaktifkan tombol analisis. Semua provider AI (OpenAI, Claude, Gemini) mendukung analisis gambar.
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                        <div>
                            <label for="image-upload" class="file-upload-label block">
                                <span id="upload-text">Klik untuk mengunggah gambar</span>
                                <input type="file" id="image-upload" class="hidden" accept="image/png, image/jpeg, image/webp">
                            </label>
                            <img id="image-preview" src="" alt="Pratinjau Gambar" class="mt-4 rounded-lg hidden w-full">
                        </div>
                        <div>
                            <button id="analyze-image-btn" class="w-full inline-flex justify-center py-3 px-4 border border-transparent shadow-sm text-base font-medium rounded-md text-white bg-teal-600 hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500 disabled:bg-gray-400" disabled>
                                Analisis Gambar
                            </button>
                            <div id="analysis-result-container" class="mt-4 hidden">
                                <div id="analysis-loading-spinner" class="hidden flex justify-center items-center my-4">
                                    <div class="spinner"></div>
                                </div>
                                <div id="analysis-error-message" class="hidden p-4 mb-4 text-sm text-red-700 bg-red-100 rounded-lg" role="alert"></div>
                                <div id="analysis-output" class="text-stone-700 space-y-4"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Other Sections (to be dynamically loaded) -->
            <section id="how-to-use" class="content-section hidden"></section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Clipboard Helper Function ---
            function copyTextToClipboard(text) {
                const textArea = document.createElement("textarea");
                textArea.style.position = 'fixed';
                textArea.style.top = 0;
                textArea.style.left = 0;
                textArea.style.width = '2em';
                textArea.style.height = '2em';
                textArea.style.padding = 0;
                textArea.style.border = 'none';
                textArea.style.outline = 'none';
                textArea.style.boxShadow = 'none';
                textArea.style.background = 'transparent';
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    const successful = document.execCommand('copy');
                    document.body.removeChild(textArea);
                    return successful;
                } catch (err) {
                    document.body.removeChild(textArea);
                    return false;
                }
            }

            // --- Initial Setup ---
            const initialHash = window.location.hash || '#prompt-generator';
            
            // --- Navigation Logic ---
            const navLinks = document.querySelectorAll('.nav-link');
            const contentSections = document.querySelectorAll('.content-section');
            const sidebar = document.getElementById('sidebar');
            const menuToggle = document.getElementById('menu-toggle');
            const overlay = document.getElementById('overlay');
            const mobileHeaderTitle = document.querySelector('#menu-toggle').previousElementSibling;

            function navigateTo(hash) {
                // Remove any existing refresh buttons
                document.querySelectorAll('.refresh-content-btn').forEach(btn => btn.remove());
                
                contentSections.forEach(section => section.classList.add('hidden'));
                const activeSection = document.querySelector(hash);
                if (activeSection) {
                    activeSection.classList.remove('hidden');
                    
                    const sectionId = hash.substring(1);
                    const needsDynamicLoading = ['how-to-use'].includes(sectionId);
                    
                    if (needsDynamicLoading) {
                        const apiKey = document.getElementById('api-key').value;
                        const hasContent = activeSection.innerHTML.trim() !== '' && 
                                         !activeSection.innerHTML.includes('API Key Diperlukan') &&
                                         !activeSection.innerHTML.includes('Memuat Konten Dinamis') &&
                                         !activeSection.innerHTML.includes('Gagal Memuat Konten');
                        
                        if (!hasContent) {
                            loadSectionContent(sectionId);
                        } else if (apiKey) {
                            // Add refresh button for dynamic content
                            const existingRefreshBtn = activeSection.querySelector('.refresh-content-btn');
                            if (!existingRefreshBtn) {
                                const refreshBtn = document.createElement('div');
                                refreshBtn.className = 'refresh-content-btn fixed bottom-6 right-6 z-50';
                                refreshBtn.innerHTML = `
                                    <button onclick="refreshDynamicContent('${sectionId}')" 
                                            class="bg-teal-600 hover:bg-teal-700 text-white px-4 py-2 rounded-full shadow-lg transition-colors text-sm flex items-center space-x-2">
                                        <span>üîÑ</span><span>Refresh Konten</span>
                                    </button>`;
                                activeSection.appendChild(refreshBtn);
                            }
                        }
                    }
                }
                
                let activeLinkText = 'Generator Prompt';
                navLinks.forEach(link => {
                    const isActive = link.getAttribute('href') === hash;
                    link.classList.toggle('active', isActive);
                    if(isActive) {
                        activeLinkText = link.textContent.trim();
                    }
                });
                mobileHeaderTitle.textContent = activeLinkText;
                window.scrollTo(0, 0);
            }

            navLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    e.preventDefault();
                    window.location.hash = this.getAttribute('href');
                    if (sidebar.classList.contains('translate-x-0')) toggleMenu();
                });
            });
            
            window.addEventListener('hashchange', () => navigateTo(window.location.hash || '#prompt-generator'));
            
            function toggleMenu() {
                sidebar.classList.toggle('-translate-x-full');
                sidebar.classList.toggle('translate-x-0');
                overlay.classList.toggle('opacity-50');
                overlay.classList.toggle('pointer-events-none');
            }
            menuToggle.addEventListener('click', toggleMenu);
            overlay.addEventListener('click', toggleMenu);

            // --- Prompt Generator Logic ---
            const generateBtn = document.getElementById('generate-btn');
            const resultContainer = document.getElementById('result-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            const errorMessage = document.getElementById('error-message');
            const promptOutputContainer = document.getElementById('prompt-output-container');
            const batchActions = document.getElementById('batch-actions');
            const copyAllBtn = document.getElementById('copy-all-btn');
            const downloadBtn = document.getElementById('download-btn');
            
            const promptCountSlider = document.getElementById('prompt-count');
            const promptCountValue = document.getElementById('prompt-count-value');
            promptCountSlider.addEventListener('input', (e) => promptCountValue.textContent = e.target.value);

            // API Key validation on input
            const apiKeyInput = document.getElementById('api-key');
            const apiKeyStatus = document.getElementById('api-key-status');
            const apiKeyValid = document.getElementById('api-key-valid');
            const apiKeyInvalid = document.getElementById('api-key-invalid');
            const apiKeyLoading = document.getElementById('api-key-loading');
            const apiKeyMessage = document.getElementById('api-key-message');
            
            let validationTimeout;
            apiKeyInput.addEventListener('input', (e) => {
                const apiKey = e.target.value.trim();
                
                // Reset status
                apiKeyStatus.classList.add('hidden');
                apiKeyValid.classList.add('hidden');
                apiKeyInvalid.classList.add('hidden');
                apiKeyLoading.classList.add('hidden');
                apiKeyMessage.classList.add('hidden');
                
                if (validationTimeout) clearTimeout(validationTimeout);
                
                if (apiKey.length > 10) {
                    // Show loading
                    apiKeyStatus.classList.remove('hidden');
                    apiKeyLoading.classList.remove('hidden');
                    
                    validationTimeout = setTimeout(async () => {
                        const validation = await validateApiKey(apiKey);
                        
                        // Hide loading
                        apiKeyLoading.classList.add('hidden');
                        
                        if (validation.valid) {
                            apiKeyValid.classList.remove('hidden');
                            apiKeyMessage.textContent = validation.message;
                            apiKeyMessage.className = 'mt-1 text-xs text-green-600';
                            apiKeyMessage.classList.remove('hidden');
                        } else {
                            apiKeyInvalid.classList.remove('hidden');
                            apiKeyMessage.textContent = validation.message;
                            apiKeyMessage.className = 'mt-1 text-xs text-red-600';
                            apiKeyMessage.classList.remove('hidden');
                        }
                    }, 1000); // Debounce 1 second
                }
            });

            const mjSettingsCheckbox = document.getElementById('mj-settings-checkbox');
            const mjSettingsContent = document.getElementById('mj-settings-content');
            const mjStylizeSlider = document.getElementById('mj-stylize');
            const mjStylizeValue = document.getElementById('mj-stylize-value');
            const mjChaosSlider = document.getElementById('mj-chaos');
            const mjChaosValue = document.getElementById('mj-chaos-value');

            mjSettingsCheckbox.addEventListener('change', () => {
                const isChecked = mjSettingsCheckbox.checked;
                mjSettingsContent.style.maxHeight = isChecked ? `${mjSettingsContent.scrollHeight}px` : '0px';
            });

            mjStylizeSlider.addEventListener('input', (e) => mjStylizeValue.textContent = e.target.value);
            mjChaosSlider.addEventListener('input', (e) => mjChaosValue.textContent = e.target.value);

            generateBtn.addEventListener('click', async () => {
                const provider = document.getElementById('api-provider').value;
                const apiKey = document.getElementById('api-key').value;
                const theme = document.getElementById('evergreen-theme').value;
                const customDetails = document.getElementById('custom-details').value;
                const promptCount = promptCountSlider.value;

                if (!apiKey) {
                    alert('Silakan masukkan kunci API Anda.');
                    return;
                }

                resultContainer.classList.remove('hidden');
                loadingSpinner.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                promptOutputContainer.classList.add('hidden');
                batchActions.classList.add('hidden');
                promptOutputContainer.innerHTML = '';

                let mjParams = '';
                if (mjSettingsCheckbox.checked) {
                    const mjAr = document.getElementById('mj-ar').value;
                    const mjStyle = document.getElementById('mj-style').value;
                    const mjStylize = mjStylizeSlider.value;
                    const mjChaos = mjChaosSlider.value;
                    
                    mjParams = '--v 7';
                    if (mjAr) mjParams += ` --ar ${mjAr}`;
                    if (mjStyle) mjParams += ` --style ${mjStyle}`;
                    if (mjStylize !== '100') mjParams += ` --s ${mjStylize}`;
                    if (mjChaos !== '0') mjParams += ` --c ${mjChaos}`;
                }

                const systemPrompt = `You are an expert prompt engineer for microstock platforms. Your task is to generate a list of detailed, layered, and highly effective image prompts for an AI image generator like Midjourney. The prompts must be in English. The goal is to create photorealistic, high-quality images suitable for Adobe Stock, focusing on an "evergreen" concept. Each prompt should be a complete, self-contained string. Do not add numbers or bullet points before each prompt. Generate exactly ${promptCount} distinct prompts based on the user's request. Return the output as a JSON object with a single key "prompts" which is an array of strings. For example: {"prompts": ["prompt one...", "prompt two..."]}. Do NOT include Midjourney parameters like --ar, --v, --s, --c in your generated prompts. These will be appended by the application. Focus only on the descriptive text.`;
                const userPrompt = `Evergreen Theme: "${theme}". Custom Details: "${customDetails || 'No additional details.'}"`;

                try {
                    let promptsArray = [];
                    let requestBody, requestUrl, requestHeaders;

                    if (provider === 'openai') {
                        requestUrl = 'https://api.openai.com/v1/chat/completions';
                        requestHeaders = { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` };
                        requestBody = JSON.stringify({ model: 'gpt-4o', messages: [{ role: 'system', content: systemPrompt }, { role: 'user', content: userPrompt }], temperature: 0.8, response_format: { "type": "json_object" } });
                    } else if (provider === 'gemini') {
                        requestUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                        requestHeaders = { 'Content-Type': 'application/json' };
                        requestBody = JSON.stringify({ contents: [{ role: 'user', parts: [{ text: `${systemPrompt}\n\nUser Request:\n${userPrompt}` }] }], generationConfig: { response_mime_type: "application/json" } });
                    } else if (provider === 'claude') {
                        requestUrl = 'https://api.anthropic.com/v1/messages';
                        requestHeaders = { 'Content-Type': 'application/json', 'x-api-key': apiKey, 'anthropic-version': '2023-06-01' };
                        requestBody = JSON.stringify({ model: 'claude-3-sonnet-20240229', max_tokens: 4096, system: systemPrompt, messages: [{ role: 'user', content: userPrompt }] });
                    }
                    
                    const response = await fetch(requestUrl, { method: 'POST', headers: requestHeaders, body: requestBody });
                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error(`API error: ${response.status} ${response.statusText} - ${errorData}`);
                    }
                    const data = await response.json();

                    if (provider === 'openai') {
                        promptsArray = JSON.parse(data.choices[0].message.content).prompts;
                    } else if (provider === 'gemini') {
                         promptsArray = data.candidates[0].content.parts[0].text ? JSON.parse(data.candidates[0].content.parts[0].text).prompts : [];
                    } else if (provider === 'claude') {
                        const textResponse = data.content[0].text;
                        const jsonMatch = textResponse.match(/\{[\s\S]*\}/);
                        if (jsonMatch) {
                            promptsArray = JSON.parse(jsonMatch[0]).prompts;
                        } else { throw new Error("Could not parse JSON from Claude's response."); }
                    }

                    if (!promptsArray || promptsArray.length === 0) throw new Error("API returned an empty or invalid list of prompts.");

                    promptsArray.forEach(promptText => {
                        const finalPrompt = `${promptText.trim()} ${mjParams}`.trim();
                        const promptDiv = document.createElement('div');
                        promptDiv.className = 'p-4 bg-stone-50 rounded-md border border-stone-200';
                        
                        const p = document.createElement('p');
                        p.className = 'text-stone-700 whitespace-pre-wrap generated-prompt-text';
                        p.textContent = finalPrompt;

                        const copyBtn = document.createElement('button');
                        copyBtn.className = 'mt-3 inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm text-white bg-gray-600 hover:bg-gray-700';
                        copyBtn.textContent = 'Salin';
                        copyBtn.onclick = () => {
                            if (copyTextToClipboard(finalPrompt)) {
                                copyBtn.textContent = 'Disalin!';
                                setTimeout(() => { copyBtn.textContent = 'Salin'; }, 2000);
                            } else {
                                alert('Gagal menyalin prompt.');
                            }
                        };
                        
                        promptDiv.appendChild(p);
                        promptDiv.appendChild(copyBtn);
                        promptOutputContainer.appendChild(promptDiv);
                    });

                    promptOutputContainer.classList.remove('hidden');
                    batchActions.classList.remove('hidden');

                } catch (error) {
                    console.error('Error generating prompts:', error);
                    errorMessage.textContent = `Terjadi kesalahan: ${error.message}`;
                    errorMessage.classList.remove('hidden');
                } finally {
                    loadingSpinner.classList.add('hidden');
                }
            });

            copyAllBtn.addEventListener('click', () => {
                const allPrompts = Array.from(document.querySelectorAll('.generated-prompt-text'))
                                      .map(p => p.textContent)
                                      .join('\n\n');
                if (copyTextToClipboard(allPrompts)) {
                    copyAllBtn.textContent = 'Berhasil Disalin!';
                    setTimeout(() => { copyAllBtn.textContent = 'Salin Semua'; }, 2000);
                } else {
                    alert('Gagal menyalin semua prompt.');
                }
            });

            downloadBtn.addEventListener('click', () => {
                const allPrompts = Array.from(document.querySelectorAll('.generated-prompt-text'))
                                      .map(p => p.textContent)
                                      .join('\n\n');
                const blob = new Blob([allPrompts], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'generated_prompts.txt';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });

            // --- Gemini Feature: Dynamic Theme Ideation ---
            const fetchThemeIdeasBtn = document.getElementById('fetch-theme-ideas-btn');
            const evergreenThemeSelect = document.getElementById('evergreen-theme');

            fetchThemeIdeasBtn.addEventListener('click', async () => {
                const apiKey = document.getElementById('api-key').value;
                const provider = document.getElementById('api-provider').value;
                
                if (!apiKey) {
                    alert('Silakan masukkan kunci API Anda di kolom nomor 2 untuk menggunakan fitur ini.');
                    return;
                }
                
                const topic = prompt("Masukkan topik umum untuk ide tema (contoh: 'teknologi', 'keuangan', 'alam'):");
                if (!topic) return;

                const originalBtnText = fetchThemeIdeasBtn.textContent;
                fetchThemeIdeasBtn.textContent = 'Mencari...';
                fetchThemeIdeasBtn.disabled = true;

                const systemPrompt = `You are a creative strategist for a microstock platform. Based on the user's topic, generate 5 specific, marketable, and evergreen visual concepts. The concepts should be suitable for a dropdown list. Return the output as a JSON object with a single key "themes" which is an array of strings. Example: {"themes": ["Cybersecurity Abstract Visualization", "Sustainable Green Tech in Urban Environments", "Minimalist Fintech Icons"]}`;
                const userPrompt = `Topic: "${topic}"`;
                
                try {
                    let response, requestUrl, requestHeaders, requestBody;
                    
                    if (provider === 'openai') {
                        requestUrl = 'https://api.openai.com/v1/chat/completions';
                        requestHeaders = { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` };
                        requestBody = JSON.stringify({ 
                            model: 'gpt-4o', 
                            messages: [
                                { role: 'system', content: systemPrompt }, 
                                { role: 'user', content: userPrompt }
                            ], 
                            temperature: 0.8, 
                            response_format: { "type": "json_object" } 
                        });
                    } else if (provider === 'claude') {
                        requestUrl = 'https://api.anthropic.com/v1/messages';
                        requestHeaders = { 
                            'x-api-key': apiKey, 
                            'Content-Type': 'application/json', 
                            'anthropic-version': '2023-06-01' 
                        };
                        requestBody = JSON.stringify({ 
                            model: 'claude-3-sonnet-20240229', 
                            max_tokens: 1000, 
                            messages: [{ role: 'user', content: `${systemPrompt}\n\n${userPrompt}` }] 
                        });
                    } else { // gemini
                        requestUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                        requestHeaders = { 'Content-Type': 'application/json' };
                        requestBody = JSON.stringify({
                            contents: [{ role: 'user', parts: [{ text: `${systemPrompt}\n\n${userPrompt}` }] }],
                            generationConfig: { response_mime_type: "application/json" }
                        });
                    }
                    
                    response = await fetch(requestUrl, {
                        method: 'POST',
                        headers: requestHeaders,
                        body: requestBody
                    });
                    
                    if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                    const data = await response.json();
                    
                    let themes;
                    if (provider === 'openai') {
                        themes = JSON.parse(data.choices[0].message.content).themes;
                    } else if (provider === 'claude') {
                        themes = JSON.parse(data.content[0].text).themes;
                    } else { // gemini
                        themes = JSON.parse(data.candidates[0].content.parts[0].text).themes;
                    }
                    
                    // Clear all existing options and add only new AI-generated themes
                    evergreenThemeSelect.innerHTML = '';
                    
                    // Add new themes
                    themes.forEach(theme => {
                        const option = document.createElement('option');
                        option.value = theme;
                        option.textContent = theme;
                        evergreenThemeSelect.appendChild(option);
                    });

                } catch (error) {
                    console.error('Error fetching theme ideas:', error);
                    alert(`Gagal mengambil ide tema: ${error.message}`);
                } finally {
                    fetchThemeIdeasBtn.textContent = originalBtnText;
                    fetchThemeIdeasBtn.disabled = false;
                }
            });

            // --- Gemini Feature: Image Analyzer ---
            const imageUpload = document.getElementById('image-upload');
            const imagePreview = document.getElementById('image-preview');
            const analyzeImageBtn = document.getElementById('analyze-image-btn');
            const analysisResultContainer = document.getElementById('analysis-result-container');
            const analysisLoadingSpinner = document.getElementById('analysis-loading-spinner');
            const analysisErrorMessage = document.getElementById('analysis-error-message');
            const analysisOutput = document.getElementById('analysis-output');
            const uploadText = document.getElementById('upload-text');

            let base64Image = null;

            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        imagePreview.src = event.target.result;
                        imagePreview.classList.remove('hidden');
                        uploadText.classList.add('hidden');
                        base64Image = event.target.result.split(',')[1];
                        analyzeImageBtn.disabled = false;
                    };
                    reader.readAsDataURL(file);
                }
            });

            analyzeImageBtn.addEventListener('click', async () => {
                const apiKey = document.getElementById('api-key').value;
                const provider = document.getElementById('api-provider').value;
                
                if (!apiKey) {
                    alert('Silakan masukkan kunci API Anda di tab "Generator Prompt" untuk menggunakan fitur ini.');
                    return;
                }
                if (!base64Image) {
                    alert('Silakan unggah gambar terlebih dahulu.');
                    return;
                }

                analysisResultContainer.classList.remove('hidden');
                analysisLoadingSpinner.classList.remove('hidden');
                analysisErrorMessage.classList.add('hidden');
                analysisOutput.innerHTML = '';

                const systemPrompt = `You are a world-class microstock image analyst. Analyze the provided image and give a detailed breakdown for a contributor who wants to create similar high-quality stock images. Provide your analysis in structured markdown. The analysis must include these sections: **Subjek Utama & Aksi**, **Komposisi & Framing**, **Pencahayaan & Warna**, **Gaya & Mood**, and **Saran Kata Kunci (Keywords)**. Be specific and provide actionable insights.`;

                try {
                    let response, requestUrl, requestHeaders, requestBody;
                    
                    if (provider === 'openai') {
                        requestUrl = 'https://api.openai.com/v1/chat/completions';
                        requestHeaders = { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKey}` };
                        requestBody = JSON.stringify({
                            model: 'gpt-4o',
                            messages: [{
                                role: 'user',
                                content: [
                                    { type: 'text', text: systemPrompt },
                                    { type: 'image_url', image_url: { url: `data:image/jpeg;base64,${base64Image}` } }
                                ]
                            }],
                            max_tokens: 1000
                        });
                    } else if (provider === 'claude') {
                        requestUrl = 'https://api.anthropic.com/v1/messages';
                        requestHeaders = { 
                            'x-api-key': apiKey, 
                            'Content-Type': 'application/json', 
                            'anthropic-version': '2023-06-01' 
                        };
                        requestBody = JSON.stringify({
                            model: 'claude-3-sonnet-20240229',
                            max_tokens: 1000,
                            messages: [{
                                role: 'user',
                                content: [
                                    { type: 'text', text: systemPrompt },
                                    { type: 'image', source: { type: 'base64', media_type: 'image/jpeg', data: base64Image } }
                                ]
                            }]
                        });
                    } else { // gemini
                        requestUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                        requestHeaders = { 'Content-Type': 'application/json' };
                        requestBody = JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: systemPrompt },
                                    { inline_data: { mime_type: "image/jpeg", data: base64Image } }
                                ]
                            }]
                        });
                    }
                    
                    response = await fetch(requestUrl, {
                        method: 'POST',
                        headers: requestHeaders,
                        body: requestBody
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.text();
                        throw new Error(`API error: ${response.status} ${response.statusText} - ${errorData}`);
                    }
                    const data = await response.json();
                    
                    let analysisText;
                    if (provider === 'openai') {
                        if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                            throw new Error('Respons OpenAI tidak valid atau kosong');
                        }
                        analysisText = data.choices[0].message.content;
                    } else if (provider === 'claude') {
                        if (!data.content || !data.content[0] || !data.content[0].text) {
                            throw new Error('Respons Claude tidak valid atau kosong');
                        }
                        analysisText = data.content[0].text;
                    } else { // gemini
                        if (!data.candidates || !data.candidates[0] || !data.candidates[0].content || !data.candidates[0].content.parts || !data.candidates[0].content.parts[0]) {
                            throw new Error('Respons Gemini tidak valid atau kosong');
                        }
                        analysisText = data.candidates[0].content.parts[0].text;
                    }
                    
                    // Simple markdown to HTML conversion
                    analysisText = analysisText
                        .replace(/\*\*(.*?)\*\*/g, '<strong class="text-stone-900">$1</strong>')
                        .replace(/\n/g, '<br>');

                    analysisOutput.innerHTML = analysisText;

                } catch (error) {
                    console.error('Error analyzing image:', error);
                    analysisErrorMessage.textContent = `Gagal menganalisis gambar: ${error.message}`;
                    analysisErrorMessage.classList.remove('hidden');
                } finally {
                    analysisLoadingSpinner.classList.add('hidden');
                }
            });
            
            // --- API Key Validation ---
            async function validateApiKey(apiKey) {
                if (!apiKey || apiKey.trim().length < 10) {
                    return { valid: false, message: 'API key terlalu pendek atau kosong' };
                }
                
                const provider = document.getElementById('api-provider').value;
                
                try {
                    let response;
                    
                    if (provider === 'openai') {
                        response = await fetch('https://api.openai.com/v1/models', {
                            method: 'GET',
                            headers: { 
                                'Authorization': `Bearer ${apiKey}`,
                                'Content-Type': 'application/json'
                            }
                        });
                    } else if (provider === 'claude') {
                        response = await fetch('https://api.anthropic.com/v1/messages', {
                            method: 'POST',
                            headers: { 
                                'x-api-key': apiKey,
                                'Content-Type': 'application/json',
                                'anthropic-version': '2023-06-01'
                            },
                            body: JSON.stringify({
                                model: 'claude-3-sonnet-20240229',
                                max_tokens: 1,
                                messages: [{ role: 'user', content: 'test' }]
                            })
                        });
                    } else { // gemini
                        response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`, {
                            method: 'GET',
                            headers: { 'Content-Type': 'application/json' }
                        });
                    }
                    
                    if (response.ok || (provider === 'claude' && response.status === 400)) {
                        return { valid: true, message: 'API key valid' };
                    } else if (response.status === 401 || response.status === 403) {
                        return { valid: false, message: 'API key tidak valid atau tidak memiliki akses' };
                    } else if (response.status === 400 && provider !== 'claude') {
                        return { valid: false, message: 'Format API key tidak benar' };
                    } else {
                        return { valid: false, message: `Error validasi: ${response.status}` };
                    }
                } catch (error) {
                    return { valid: false, message: 'Gagal memvalidasi API key. Periksa koneksi internet.' };
                }
            }

            // --- Refresh Dynamic Content ---
            function refreshDynamicContent(sectionId) {
                console.log('Refreshing content for:', sectionId);
                const section = document.getElementById(sectionId);
                if (section) {
                    section.innerHTML = ''; // Clear current content
                    loadSectionContent(sectionId);
                }
            }

            // --- Lazy Loading for Minimized Content ---
            async function loadSectionContent(sectionId) {
                const section = document.getElementById(sectionId);
                if (!section) return;

                const apiKey = document.getElementById('api-key').value;
                const provider = document.getElementById('api-provider').value;
                
                // Get provider-specific information
                const providerInfo = {
                    openai: { name: 'OpenAI GPT-4o', keyName: 'OpenAI API key' },
                    claude: { name: 'Claude 3 Sonnet', keyName: 'Anthropic Claude API key' },
                    gemini: { name: 'Gemini 1.5 Flash', keyName: 'Google Gemini API key' }
                };
                
                const currentProvider = providerInfo[provider] || providerInfo.gemini;
                
                const noApiKeyHtml = `
                    <div class="section-card">
                        <div class="p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-800">
                            <h4 class="font-bold text-lg mb-3">üîë API Key Diperlukan untuk Konten Dinamis</h4>
                            <p class="mb-4">Bagian ini menggunakan AI (${currentProvider.name}) untuk menghasilkan konten yang selalu up-to-date dan relevan dengan tren pasar terkini.</p>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-2">
                                    <span class="font-semibold text-blue-700">1.</span>
                                    <p>Kunjungi tab <a href="#prompt-generator" class="font-semibold underline hover:text-blue-900">Generator Prompt</a></p>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="font-semibold text-blue-700">2.</span>
                                    <p>Masukkan ${currentProvider.keyName} Anda di kolom yang tersedia</p>
                                </div>
                                <div class="flex items-start space-x-2">
                                    <span class="font-semibold text-blue-700">3.</span>
                                    <p>Kembali ke tab ini untuk melihat konten yang dihasilkan secara dinamis</p>
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-blue-100 rounded-lg">
                                <p class="text-sm"><strong>Keuntungan konten dinamis:</strong> Informasi terbaru, analisis real-time, dan insights yang disesuaikan dengan kondisi pasar saat ini.</p>
                            </div>
                        </div>
                    </div>`;

                // Static content loading for remaining sections
                if (sectionId === 'how-to-use') {
                        section.innerHTML = `
                            <div class="section-card">
                                <h2 class="text-2xl font-bold text-stone-900 mb-4">‚ùì Cara Menggunakan Dasbor Strategis</h2>
                                <p class="text-stone-600 mb-6">Selamat datang di panduan penggunaan! Aplikasi ini dirancang untuk menjadi asisten strategis Anda dalam menciptakan konten visual AI yang laku di pasar microstock. Ikuti langkah-langkah berikut untuk memaksimalkan potensi alat ini.</p>
                                <div class="space-y-4">
                                    <div class="p-4 bg-stone-50 border-l-4 border-teal-500 rounded-r-lg">
                                        <h4 class="font-bold text-lg">Langkah 1: Eksekusi dengan Generator Prompt</h4>
                                        <p class="mt-2 text-stone-600">Halaman utama aplikasi ini adalah <a href="#prompt-generator" class="text-teal-600 font-semibold">Generator Prompt</a>. Ikuti alur ini:</p>
                                        <ul class="mt-3 list-decimal list-inside text-stone-600 space-y-2">
                                            <li><b>Pilih Penyedia AI & Masukkan Kunci API:</b> Pilih model AI yang Anda miliki dan masukkan kunci API Anda. Kunci ini tidak kami simpan.</li>
                                            <li><b>Pilih Tema & Jumlah:</b> Pilih tema evergreen atau gunakan tombol "Cari Ide Tema" untuk inspirasi baru. Gunakan slider untuk menentukan jumlah prompt.</li>
                                            <li><b>Kustomisasi:</b> Tambahkan detail spesifik di kotak "Detail Kustom".</li>
                                            <li><b>Pengaturan Midjourney (Opsional):</b> Centang kotak untuk menambahkan parameter teknis seperti Aspect Ratio (--ar) dan Stylize (--s).</li>
                                            <li><b>Hasilkan & Ekspor:</b> Klik tombol "Hasilkan Prompt". Setelah selesai, salin atau unduh semua hasil sekaligus.</li>
                                        </ul>
                                    </div>
                                    <div class="p-4 bg-stone-50 border-l-4 border-teal-500 rounded-r-lg">
                                        <h4 class="font-bold text-lg">Langkah 2: Analisis Visual untuk Inspirasi</h4>
                                        <p class="mt-2 text-stone-600">Gunakan <a href="#image-analyzer" class="text-teal-600 font-semibold">Analisis Tren Visual</a> untuk menganalisis gambar yang sudah populer dan mendapatkan insight untuk prompt Anda:</p>
                                        <ul class="mt-3 list-decimal list-inside text-stone-600 space-y-2">
                                            <li><b>Unggah Gambar Referensi:</b> Pilih gambar yang sukses atau sedang tren di platform microstock.</li>
                                            <li><b>Analisis AI:</b> Gemini akan menganalisis subjek, komposisi, pencahayaan, gaya, dan memberikan saran kata kunci.</li>
                                            <li><b>Terapkan Insight:</b> Gunakan hasil analisis untuk membuat prompt yang lebih efektif di Generator Prompt.</li>
                                        </ul>
                                    </div>
                                    <div class="p-4 bg-stone-50 border-l-4 border-amber-500 rounded-r-lg">
                                        <h4 class="font-bold text-lg">üí° Tips Sukses Microstock</h4>
                                        <div class="mt-2 text-stone-600 space-y-2">
                                            <p><b>Tema Evergreen:</b> Fokus pada tema yang selalu dibutuhkan seperti teknologi, bisnis, kesehatan, dan alam.</p>
                                            <p><b>Kualitas Tinggi:</b> Pastikan gambar memiliki resolusi tinggi, komposisi yang baik, dan pencahayaan yang optimal.</p>
                                            <p><b>Kata Kunci Strategis:</b> Gunakan kata kunci yang spesifik dan relevan untuk meningkatkan discoverability.</p>
                                            <p><b>Konsistensi:</b> Kembangkan gaya visual yang konsisten untuk membangun brand portfolio Anda.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>`;
                        
                        return;
                }
            }

            // --- Theme Toggle ---
            const themeToggle = document.getElementById('theme-toggle');
            const themeText = document.getElementById('theme-text');
            const themeIcon = document.getElementById('theme-icon');
            
            function setTheme(isDark) {
                const themeTextElement = document.getElementById('theme-text');
                const themeIconElement = document.getElementById('theme-icon');
                
                if (isDark) {
                    document.documentElement.classList.add('dark');
                    if (themeTextElement) themeTextElement.textContent = 'üåô Mode Gelap';
                    if (themeIconElement) themeIconElement.textContent = '‚òÄÔ∏è';
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    if (themeTextElement) themeTextElement.textContent = '‚òÄÔ∏è Mode Terang';
                    if (themeIconElement) themeIconElement.textContent = 'üåô';
                    localStorage.setItem('theme', 'light');
                }
            }
            
            // Add provider change listener to refresh dynamic content
            const apiProviderSelect = document.getElementById('api-provider');
            if (apiProviderSelect) {
                apiProviderSelect.addEventListener('change', () => {
                    // Refresh any currently loaded dynamic content sections
                    const currentSection = document.querySelector('.content-section.active');
                    if (currentSection) {
                        const sectionId = currentSection.id;
                        if (sectionId === 'how-to-use') {
                            reloadSection(sectionId);
                        }
                    }
                });
            }
            
            // Load saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark' || (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                setTheme(true);
            }
            
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    const isDark = document.documentElement.classList.contains('dark');
                    setTheme(!isDark);
                });
            }
            
            
            navigateTo(initialHash); 
        });
    </script>
    
    <!-- Floating Donation Button -->
    <div id="donation-button" class="fixed bottom-6 right-6 z-50">
        <a href="https://trakteer.id/anton-prafanto-nszpm/tip" target="_blank" rel="noopener noreferrer" class="bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-600 hover:to-red-600 text-white px-4 py-3 rounded-full shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center space-x-2 text-sm font-medium">
            <span>‚òï</span>
            <span id="donation-text">Dukung Karya Ini</span>
        </a>
    </div>
</body>
</html>
